<style>
  .category-card {
    transition: all 0.2s ease;
    border: 1px solid #e2e8f0;
  }
  .category-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
    border-color: #cbd5e1;
  }
  .status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 6px;
  }

  /* Modal Styles (Scoped) */
  .modal {
    display: none;
    position: fixed;
    z-index: 60;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
  }
  /* Override flex display for modals when active */
  .modal.active { display: flex !important; }

  .modal-content {
    background-color: white;
    padding: 1.5rem;
    border-radius: 16px;
    width: 95%;
    max-width: 450px;
    position: relative;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    animation: scaleUp 0.2s ease-out;
  }
  @keyframes scaleUp {
    from { transform: scale(0.95); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  @media (max-width: 768px) {
    .category-grid { grid-template-columns: 1fr !important; }
    .action-buttons { flex-direction: column; gap: 0.5rem; }
  }
</style>

<div class="fade-in">
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div class="bg-white p-6 rounded-xl shadow border border-gray-100">
      <div class="flex items-center">
        <div class="p-3 bg-blue-100 rounded-lg mr-4">
          <i class="fas fa-tags text-blue-600 text-xl"></i>
        </div>
        <div>
          <p class="text-gray-500 text-sm">Total Kategori</p>
          <p class="text-2xl font-bold text-gray-800">{{.TotalKategori}}</p>
        </div>
      </div>
    </div>
    <div class="bg-white p-6 rounded-xl shadow border border-gray-100">
      <div class="flex items-center">
        <div class="p-3 bg-green-100 rounded-lg mr-4">
          <i class="fas fa-check-circle text-green-600 text-xl"></i>
        </div>
        <div>
          <p class="text-gray-500 text-sm">Kategori Aktif</p>
          <p class="text-2xl font-bold text-gray-800">{{ .KategoriAktif}}</p>
        </div>
      </div>
    </div>
    <div class="bg-white p-6 rounded-xl shadow border border-gray-100">
      <div class="flex items-center">
        <div class="p-3 bg-yellow-100 rounded-lg mr-4">
          <i class="fas fa-pause-circle text-yellow-600 text-xl"></i>
        </div>
        <div>
          <p class="text-gray-500 text-sm">Kategori Nonaktif</p>
          <p class="text-2xl font-bold text-gray-800">{{ .KategoriNonaktif}}</p>
        </div>
      </div>
    </div>
    <div class="bg-white p-6 rounded-xl shadow border border-gray-100">
      <div class="flex items-center">
        <div class="p-3 bg-purple-100 rounded-lg mr-4">
          <i class="fas fa-boxes text-purple-600 text-xl"></i>
        </div>
        <div>
          <p class="text-gray-500 text-sm">Produk Terkait</p>
          <p class="text-2xl font-bold text-gray-800">{{ .TotalProduk}}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl shadow p-4 mb-8">
    <div class="filter-section flex flex-col md:flex-row items-end gap-4">
      <div class="flex-1 w-full">
        <label class="block text-sm font-medium text-gray-700 mb-2">Cari Kategori</label>
        <div class="relative">
          <input type="text" id="search-input" placeholder="Nama kategori..."
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"/>
          <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>
      <div class="w-full md:w-auto">
        <button class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition text-sm w-full flex items-center justify-center gap-2"
                onclick="showAddCategoryModal()">
          <i class="fas fa-plus"></i> Tambah Kategori
        </button>
      </div>
    </div>
  </div>

  <div id="categories-container" class="category-grid grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {{ range .Data }}
    <div class="category-card bg-white rounded-xl p-5">
      <div class="text-center mb-4">
        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
          <i class="fas fa-tags text-blue-600 text-2xl"></i>
        </div>
        <h3 class="font-semibold text-gray-800">{{ .NamaCategory}}</h3>
      </div>
      <div class="space-y-2 mb-4 text-sm">
        <div class="flex justify-between">
          <span class="text-gray-600">Produk:</span>
          <span class="font-medium">45</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Status:</span>
          <span class="flex items-center text-green-600 font-medium">
                        <span class="status-indicator bg-green-500"></span> Aktif
                    </span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Dibuat:</span>
          <span class="text-sm">15 Jan 2026</span>
        </div>
      </div>
      <div class="flex action-buttons gap-2">
        <button class="flex-1 px-3 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition text-xs" onclick="showEditCategoryModal('1')">
          <i class="fas fa-edit mr-1"></i> Edit
        </button>
        <button class="px-3 py-2 bg-danger text-white rounded-lg hover:bg-red-700 transition text-xs" onclick="deleteCategory('1')">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
    {{end}}
  </div>
</div>

<div id="add-category-modal" class="modal">
  <div class="modal-content">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold text-gray-800">Tambah Kategori Baru</h3>
      <button onclick="hideAddCategoryModal()" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
    </div>
    <form class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Kategori *</label>
        <input type="text" placeholder="Contoh: Alat Tulis" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
        <textarea placeholder="Deskripsi kategori (opsional)" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none"></textarea>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Ikon Kategori</label>
        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
          <option value="pencil">ğŸ“ Alat Tulis</option>
          <option value="book">ğŸ“š Buku</option>
          <option value="cookie">ğŸª Snack</option>
          <option value="glass">ğŸ¥¤ Minuman</option>
          <option value="tshirt">ğŸ‘• Seragam</option>
          <option value="futbol">âš½ Olahraga</option>
          <option value="laptop">ğŸ’» Elektronik</option>
          <option value="medkit">ğŸ’Š Kesehatan</option>
        </select>
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="category-active" checked class="rounded border-gray-300 text-primary focus:ring-primary">
        <label for="category-active" class="ml-2 text-sm text-gray-700">Status Aktif</label>
      </div>
      <div class="flex justify-end space-x-3">
        <button type="button" onclick="hideAddCategoryModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Batal</button>
        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">Simpan</button>
      </div>
    </form>
  </div>
</div>

<div id="edit-category-modal" class="modal">
  <div class="modal-content">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold text-gray-800">Edit Kategori</h3>
      <button onclick="hideEditCategoryModal()" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times"></i></button>
    </div>
    <form class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Kategori *</label>
        <input type="text" value="Alat Tulis" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
        <textarea placeholder="Deskripsi kategori" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">Kategori untuk semua alat tulis sekolah</textarea>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Ikon Kategori</label>
        <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:outline-none">
          <option value="pencil" selected>ğŸ“ Alat Tulis</option>
          <option value="book">ğŸ“š Buku</option>
          <option value="cookie">ğŸª Snack</option>
          <option value="glass">ğŸ¥¤ Minuman</option>
          <option value="tshirt">ğŸ‘• Seragam</option>
          <option value="futbol">âš½ Olahraga</option>
          <option value="laptop">ğŸ’» Elektronik</option>
          <option value="medkit">ğŸ’Š Kesehatan</option>
        </select>
      </div>
      <div class="flex items-center">
        <input type="checkbox" id="edit-category-active" checked class="rounded border-gray-300 text-primary focus:ring-primary">
        <label for="edit-category-active" class="ml-2 text-sm text-gray-700">Status Aktif</label>
      </div>
      <div class="flex justify-end space-x-3">
        <button type="button" onclick="hideEditCategoryModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Batal</button>
        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700">Simpan Perubahan</button>
      </div>
    </form>
  </div>
</div>

<div id="delete-category-modal" class="modal">
  <div class="modal-content text-center">
    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
      <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
    </div>
    <h3 class="text-lg font-semibold text-gray-800 mb-2">Konfirmasi Hapus</h3>
    <p class="text-gray-600 mb-6">Apakah Anda yakin ingin menghapus kategori ini? Semua produk dalam kategori ini akan dipindahkan ke kategori default.</p>
    <div class="flex justify-center space-x-3">
      <button onclick="hideDeleteCategoryModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">Batal</button>
      <button onclick="confirmDeleteCategory()" class="px-4 py-2 bg-danger text-white rounded-lg hover:bg-red-700">Hapus</button>
    </div>
  </div>
</div>

<script>
  let currentCategoryId = null;

  // Modal Functions
  function showAddCategoryModal() {
    document.getElementById('add-category-modal').classList.add('active');
  }

  function hideAddCategoryModal() {
    document.getElementById('add-category-modal').classList.remove('active');
  }

  function showEditCategoryModal(categoryId) {
    currentCategoryId = categoryId;
    document.getElementById('edit-category-modal').classList.add('active');
  }

  function hideEditCategoryModal() {
    document.getElementById('edit-category-modal').classList.remove('active');
  }

  function deleteCategory(categoryId) {
    currentCategoryId = categoryId;
    document.getElementById('delete-category-modal').classList.add('active');
  }

  function hideDeleteCategoryModal() {
    document.getElementById('delete-category-modal').classList.remove('active');
  }

  function confirmDeleteCategory() {
    console.log('Deleting category:', currentCategoryId);
    alert(`Kategori berhasil dihapus!`);
    hideDeleteCategoryModal();
  }

  // Close Modals on Click Outside
  window.onclick = function(event) {
    const addModal = document.getElementById('add-category-modal');
    const editModal = document.getElementById('edit-category-modal');
    const deleteModal = document.getElementById('delete-category-modal');

    if (event.target === addModal) hideAddCategoryModal();
    if (event.target === editModal) hideEditCategoryModal();
    if (event.target === deleteModal) hideDeleteCategoryModal();
  };

  // Filter Logic
  const searchInput = document.getElementById('search-input');

  searchInput.addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase().trim();
    const categories = document.querySelectorAll('.category-card');

    categories.forEach(category => {
      const categoryName = category.querySelector('h3').textContent.toLowerCase();

      if (searchTerm === '' || categoryName.includes(searchTerm)) {
        category.style.display = 'block';
      } else {
        category.style.display = 'none';
      }
    });
  });
</script>